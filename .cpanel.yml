---
deployment:
  tasks:
    # Repo está direto em iagus.com.br/ - não precisa rsync

    # Garantir que diretórios de storage existem
    - mkdir -p /home1/abdonc73/iagus.com.br/storage/framework/sessions
    - mkdir -p /home1/abdonc73/iagus.com.br/storage/framework/views
    - mkdir -p /home1/abdonc73/iagus.com.br/storage/framework/cache/data
    - mkdir -p /home1/abdonc73/iagus.com.br/storage/logs
    - mkdir -p /home1/abdonc73/iagus.com.br/storage/app/public
    - mkdir -p /home1/abdonc73/iagus.com.br/bootstrap/cache

    # Permissões corretas
    - chmod 755 /home1/abdonc73/iagus.com.br/artisan
    - chmod -R 775 /home1/abdonc73/iagus.com.br/storage
    - chmod -R 775 /home1/abdonc73/iagus.com.br/bootstrap/cache

    # Laravel artisan (PHP 8.3 HostGator)
    - /opt/cpanel/ea-php83/root/usr/bin/php /home1/abdonc73/iagus.com.br/artisan optimize:clear
    - /opt/cpanel/ea-php83/root/usr/bin/php /home1/abdonc73/iagus.com.br/artisan migrate --force
    - /opt/cpanel/ea-php83/root/usr/bin/php /home1/abdonc73/iagus.com.br/artisan storage:link
    - /opt/cpanel/ea-php83/root/usr/bin/php /home1/abdonc73/iagus.com.br/artisan optimize
